<idea-plugin>
    <id>com.hytaledocs.hytale</id>
    <name>Hytale Docs Dev Tools</name>
    <vendor email="contact@hytale-docs.com" url="https://hytale-docs.com">HytaleDocs</vendor>

    <description><![CDATA[
<p><b>The ultimate toolkit for Hytale server plugin development.</b> Create, build, deploy, and debug your plugins without leaving IntelliJ IDEA.</p>

<hr/>

<h2>Key Features</h2>

<h3>Project Wizard</h3>
<p>Create new Hytale plugin projects in seconds with pre-configured Gradle setup, manifest.json, and ready-to-use templates.</p>
<ul>
    <li>Choose between <b>Empty</b> or <b>Full</b> templates</li>
    <li>Auto-generated Mod ID and package name</li>
    <li>Automatic server files detection</li>
</ul>

<h3>One-Click Run Configuration</h3>
<p>Build, deploy, and launch your server with a single click. The plugin handles everything:</p>
<ul>
    <li>Builds your plugin with Gradle</li>
    <li>Copies JAR to <code>server/plugins/</code></li>
    <li>Starts the server with configured memory and port</li>
    <li>Supports debugging with automatic port detection</li>
</ul>

<h3>Integrated Tool Window</h3>
<p>A powerful sidebar with 6 tabs to manage your entire workflow:</p>
<table>
    <tr><td><b>Server</b></td><td>Start/stop server, view status, configure settings</td></tr>
    <tr><td><b>Console</b></td><td>Color-coded logs, send commands, copy output</td></tr>
    <tr><td><b>Assets</b></td><td>Browse and preview game assets (images, audio, JSON)</td></tr>
    <tr><td><b>Docs</b></td><td>Search and browse API documentation offline</td></tr>
    <tr><td><b>AI</b></td><td>MCP integration for Claude, quick prompts</td></tr>
    <tr><td><b>Infos</b></td><td>Links, templates reference, contributors</td></tr>
</table>

<h3>UI File Support</h3>
<p>Full language support for Hytale <code>.ui</code> files:</p>
<ul>
    <li>Syntax highlighting for components and properties</li>
    <li>Code completion for UI elements</li>
    <li>Color preview in the gutter</li>
    <li>Color picker - click to change colors inline</li>
    <li>Code folding for Groups</li>
</ul>

<h3>Smart Code Completion</h3>
<p>Context-aware autocomplete for the Hytale API:</p>
<ul>
    <li>Event classes (<code>PlayerConnectEvent</code>, <code>PlayerChatEvent</code>...)</li>
    <li>Event methods and properties</li>
    <li>Plugin lifecycle methods</li>
</ul>

<hr/>

<h2>Getting Started</h2>

<h3>1. Create a New Project</h3>
<ol>
    <li>Go to <b>File</b> &gt; <b>New</b> &gt; <b>Project</b></li>
    <li>Select <b>Hytale Plugin</b></li>
    <li>Fill in your plugin details and click <b>Create</b></li>
</ol>

<h3>2. Setup Server (First Time)</h3>
<ol>
    <li>Go to <b>Tools</b> &gt; <b>Hytale Server</b> &gt; <b>Setup Server</b></li>
    <li>The plugin downloads Java 25 and server files automatically</li>
</ol>

<h3>3. Run Your Plugin</h3>
<ol>
    <li>Press <b>Shift+F10</b> or click the Run button</li>
    <li>Your plugin is built, deployed, and the server starts</li>
    <li>View logs in the <b>Console</b> tab</li>
</ol>

<hr/>

<h2>Live Templates</h2>
<p>Type these shortcuts and press <b>Tab</b> to expand:</p>
<table>
    <tr><td><code>hyplugin</code></td><td>Main plugin class with logger</td></tr>
    <tr><td><code>hyevent</code></td><td>Register event listener</td></tr>
    <tr><td><code>hycmd</code></td><td>Command collection class</td></tr>
    <tr><td><code>hyecs</code></td><td>ECS Event System</td></tr>
    <tr><td><code>hylistener</code></td><td>Quick event listener lambda</td></tr>
    <tr><td><code>hylogger</code></td><td>Logger declaration</td></tr>
    <tr><td><code>hymsg</code></td><td>Send message to player</td></tr>
    <tr><td><code>hyquery</code></td><td>ECS Query for entity filtering</td></tr>
    <tr><td><code>hysubcmd</code></td><td>Add sub-command</td></tr>
</table>

<hr/>

<h2>Quick File Creation</h2>
<p>Right-click a package &gt; <b>New</b> &gt; <b>Hytale</b>:</p>
<ul>
    <li><b>Hytale Plugin</b> - Main plugin class</li>
    <li><b>Hytale Listener</b> - Event listener</li>
    <li><b>Hytale Command</b> - Command handler</li>
    <li><b>Hytale UI File</b> - UI definition file</li>
</ul>

<hr/>

<h2>Server Management</h2>
<p>Available in <b>Tools</b> &gt; <b>Hytale Server</b>:</p>
<ul>
    <li><b>Setup Server</b> - Download Java 25 and server files</li>
    <li><b>Hot Reload Plugin</b> - Reload without restart</li>
    <li><b>Reload All Plugins</b> - Send /reload command</li>
</ul>

<hr/>

<h2>Resources</h2>
<p>
    <a href="https://hytale-docs.com">Documentation</a> ·
    <a href="https://hytale-docs.com/api">API Reference</a> ·
    <a href="https://hytale-docs.com/modding/plugins/project-setup">Plugin Guide</a> ·
    <a href="https://discord.gg/yAjaFBH4Y8">Discord</a> ·
    <a href="https://github.com/HytaleDocs/hytale-intellij-plugin">GitHub</a>
</p>

<hr/>

<p><i>Made with care by the <a href="https://hytale-docs.com">HytaleDocs</a> community.</i></p>
    ]]></description>

    <change-notes><![CDATA[
        <h3>1.3.7</h3>
        <ul>
            <li><b>Maven Repository Support</b> - Download server JARs directly from maven.hytale.com</li>
            <li><b>Version Selection</b> - Choose specific server versions or auto-update to latest</li>
            <li><b>Version Cache</b> - Downloaded versions are cached in ~/.hytale-intellij/servers/</li>
            <li><b>Settings UI</b> - New "Server Version" section in Settings > Tools > HytaleDocs</li>
            <li><b>Tool Window</b> - Server version now displayed in the status card</li>
        </ul>

        <h3>1.3.6</h3>
        <ul>
            <li><b>Hytale Installation Path Setting</b> - New global settings page (Settings > Tools > HytaleDocs) to configure Hytale installation path</li>
            <li><b>Manual Path Selection</b> - Added "Browse..." button in project wizard to manually select Hytale installation if auto-detection fails</li>
            <li><b>Improved Detection</b> - Installation path is now saved globally and reused across projects</li>
        </ul>

        <h3>1.3.4</h3>
        <ul>
            <li><b>Mac & Linux Support</b> - Hytale installation detection now works on macOS and Linux (thanks <a href="https://github.com/maartenpeels">@maartenpeels</a>!)</li>
            <li><b>Contributors Section</b> - New contributors card in the Infos tab</li>
            <li><b>Improved Documentation</b> - Enhanced plugin page with getting started guide</li>
        </ul>

        <h3>1.3.2</h3>
        <ul>
            <li><b>Run Configuration</b> - Build, Deploy & Debug Hytale servers with one click</li>
            <li><b>UI File Support</b> - Syntax highlighting, completion & color preview for .ui files</li>
            <li><b>Dynamic Debug Port</b> - Automatically finds available port (5005-5015)</li>
            <li><b>Auto-detect Plugin</b> - Detects plugin info from manifest.json</li>
            <li><b>Windows Fix</b> - Server restart workflow fixes JAR file locking</li>
            <li><b>Code Cleanup</b> - Removed deprecated APIs and unused code</li>
        </ul>

        <h3>1.3.1</h3>
        <ul>
            <li>Assets Explorer improvements</li>
            <li>Deploy fixes</li>
        </ul>

        <h3>1.3.0</h3>
        <ul>
            <li>New HytaleDocs branding</li>
            <li>Hytale API autocomplete</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <resource-bundle>messages.HytaleBundle</resource-bundle>

    <extensions defaultExtensionNs="com.intellij">
        <!-- New Project Wizard - Appears in "New Project" section -->
        <newProjectWizard.languageGenerator
                implementation="com.hytaledocs.intellij.wizard.HytaleNewProjectWizard"/>

        <!-- File Templates -->
        <internalFileTemplate name="Hytale Mod"/>
        <internalFileTemplate name="Hytale Listener"/>
        <internalFileTemplate name="Hytale Command"/>
        <internalFileTemplate name="Hytale ECS System"/>
        <internalFileTemplate name="Hytale UI File"/>

        <!-- ==================== Hytale UI File Support ==================== -->

        <!-- UI File Type Registration -->
        <fileType
                name="Hytale UI File"
                implementationClass="com.hytaledocs.intellij.uifile.UIFileType"
                fieldName="INSTANCE"
                language="HytaleUI"
                extensions="ui"/>

        <!-- UI Language Parser -->
        <lang.parserDefinition
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.parser.UIParserDefinition"/>

        <!-- UI Syntax Highlighting -->
        <lang.syntaxHighlighterFactory
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.highlighter.UISyntaxHighlighterFactory"/>

        <!-- UI Brace Matching -->
        <lang.braceMatcher
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.UIBraceMatcher"/>

        <!-- UI Code Folding -->
        <lang.foldingBuilder
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.UIFoldingBuilder"/>

        <!-- UI Commenting -->
        <lang.commenter
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.UICommenter"/>

        <!-- UI Code Completion -->
        <completion.contributor
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.completion.UICompletionContributor"/>

        <!-- UI Color Preview (gutter icons) -->
        <annotator
                language="HytaleUI"
                implementationClass="com.hytaledocs.intellij.uifile.highlighter.UIColorAnnotator"/>

        <!-- UI Color Settings Page -->
        <colorSettingsPage
                implementation="com.hytaledocs.intellij.uifile.highlighter.UIColorSettingsPage"/>



        <!-- Live Templates -->
        <defaultLiveTemplates file="/liveTemplates/Hytale.xml"/>
        <liveTemplateContext
                contextId="HYTALE"
                implementation="com.hytaledocs.intellij.templates.HytaleTemplateContext"/>

        <!-- Tool Window -->
        <toolWindow
                factoryClass="com.hytaledocs.intellij.toolWindow.HytaleToolWindowFactory"
                id="HytaleDocs"
                anchor="right"
                icon="/icons/hytaledocs-plugin-13.svg"/>

        <!-- Notifications -->
        <notificationGroup
                id="Hytale Plugin"
                displayType="BALLOON"/>

        <!-- Settings -->
        <!-- Application-level settings (global, before project creation) -->
        <applicationConfigurable
                parentId="tools"
                instance="com.hytaledocs.intellij.settings.HytaleAppSettingsConfigurable"
                id="com.hytaledocs.intellij.settings.HytaleAppSettings"
                displayName="HytaleDocs"/>

        <!-- Project-level settings (per project) -->
        <projectConfigurable
                parentId="tools"
                instance="com.hytaledocs.intellij.settings.HytaleSettingsConfigurable"
                id="com.hytaledocs.intellij.settings.HytaleSettings"
                displayName="Hytale Server"
                nonDefaultProject="true"/>

        <!-- Services -->
        <projectService
                serviceImplementation="com.hytaledocs.intellij.settings.HytaleServerSettings"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.ServerDownloadService"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.ServerLaunchService"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.HytaleProjectService"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.AssetScannerService"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.AssetSyncService"/>
        <projectService
                serviceImplementation="com.hytaledocs.intellij.services.ServerProfiler"/>

        <applicationService
                serviceImplementation="com.hytaledocs.intellij.settings.HytaleAppSettings"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.MavenMetadataService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.ServerVersionCacheService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.JavaInstallService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.HytaleDownloaderService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.AuthenticationService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.DocumentationService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.DocumentationApiClient"/>

        <!-- Documentation Provider for F1 Help -->
        <lang.documentationProvider
                language="JAVA"
                implementationClass="com.hytaledocs.intellij.documentation.HytaleDocumentationProvider"
                order="first"/>

        <!-- Server Data Service for API completion data -->
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.ServerDataService"/>
        <applicationService
                serviceImplementation="com.hytaledocs.intellij.services.OfflineDocsService"/>

        <!-- Code Completion for Hytale API -->
        <completion.contributor
                language="JAVA"
                implementationClass="com.hytaledocs.intellij.completion.HytaleCompletionContributor"
                order="first"/>

        <!-- Run Configuration for Hytale Server -->
        <configurationType
                implementation="com.hytaledocs.intellij.run.HytaleServerConfigurationType"/>

        <!-- Debug Runner for Hytale Server -->
        <programRunner
                implementation="com.hytaledocs.intellij.run.HytaleServerDebugRunner"/>

        <!-- Auto-setup Run Configuration for Hytale projects -->
        <postStartupActivity
                implementation="com.hytaledocs.intellij.run.HytaleRunConfigurationSetup"/>

    </extensions>

    <applicationListeners>
        <!-- Force early UILanguage init before stub indexing -->
        <listener class="com.hytaledocs.intellij.uifile.UILanguagePreloader"
                  topic="com.intellij.ide.AppLifecycleListener"/>
    </applicationListeners>

    <actions>
        <group id="HytaleDocs.NewGroup" text="Hytale" description="Hytale mod development">
            <add-to-group group-id="NewGroup" anchor="after" relative-to-action="NewGroup1"/>

            <action id="HytaleDocs.NewMod"
                    class="com.hytaledocs.intellij.actions.NewPluginAction"
                    text="Hytale Plugin"
                    description="Create a new Hytale plugin class"
                    icon="/icons/hytaledocs-plugin-16.svg"/>

            <action id="HytaleDocs.NewListener"
                    class="com.hytaledocs.intellij.actions.NewListenerAction"
                    text="Hytale Listener"
                    description="Create a new Hytale event listener"/>

            <action id="HytaleDocs.NewCommand"
                    class="com.hytaledocs.intellij.actions.NewCommandAction"
                    text="Hytale Command"
                    description="Create a new Hytale command"/>

            <action id="HytaleDocs.NewUIFile"
                    class="com.hytaledocs.intellij.uifile.action.NewUIFileAction"
                    text="Hytale UI File"
                    description="Create a new Hytale UI definition file"
                    icon="/icons/ui-file.svg"/>
        </group>


        <group id="HytaleDocs.ToolsMenu" text="Hytale Server" description="Hytale server management">
            <add-to-group group-id="ToolsMenu" anchor="last"/>

            <action id="HytaleDocs.SetupServer"
                    class="com.hytaledocs.intellij.actions.SetupServerAction"
                    text="Setup Server..."
                    description="Download Java 25 and server files for Hytale development"
                    icon="/icons/hytaledocs-plugin-16.svg"/>

            <action id="HytaleDocs.DownloadServerJar"
                    class="com.hytaledocs.intellij.actions.DownloadServerJarAction"
                    text="Download Server JAR (Maven)"
                    description="Download HytaleServer.jar from Maven repository with version selection"/>

            <separator/>

            <action id="HytaleDocs.QuickReloadPlugins"
                    class="com.hytaledocs.intellij.actions.QuickReloadPluginsAction"
                    text="Reload All Plugins"
                    description="Send /reload plugins command to the running Hytale server"
                    icon="AllIcons.Actions.Refresh"/>

            <action id="HytaleDocs.HotReloadPlugin"
                    class="com.hytaledocs.intellij.actions.HotReloadPluginAction"
                    text="Hot Reload Plugin"
                    description="Build and reload your plugin on the running server (Build → Unload → Deploy → Load)"
                    icon="AllIcons.Actions.ForceRefresh"/>

            <separator/>

            <action id="HytaleDocs.ReconfigureRunConfig"
                    class="com.hytaledocs.intellij.actions.ReconfigureRunConfigAction"
                    text="Reconfigure Run Configuration"
                    description="Auto-detect plugin info and update the Hytale Server run configuration"
                    icon="AllIcons.Actions.Refresh"/>
        </group>
    </actions>
</idea-plugin>
